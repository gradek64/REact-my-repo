<!DOCTYPE html>
<!-- saved from url=(0048)https://pierrehedkvist.com/posts/react-state-url -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" href="https://pierrehedkvist.com/favicon/favicon.ico"><meta name="description" content="Learn how to build a personal website using Next.js"><meta property="og:image" content="https://og-image.vercel.app/Pierre%20Hedkvist.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.zeit.co%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"><meta name="og:title" content="Pierre Hedkvist"><meta name="twitter:card" content="summary_large_image"><link rel="apple-touch-icon" sizes="180x180" href="https://pierrehedkvist.com/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://pierrehedkvist.com/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://pierrehedkvist.com/favicon/favicon-16x16.png"><link rel="manifest" href="https://pierrehedkvist.com/favicon/site.webmanifest"><link rel="mask-icon" href="https://pierrehedkvist.com/favicon/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><link rel="preload" as="image" imagesrcset="/_next/image?url=%2Fimages%2Fme.png&amp;w=128&amp;q=75 1x, /_next/image?url=%2Fimages%2Fme.png&amp;w=256&amp;q=75 2x"><title>Storing state in the URL with React</title><script async="" src="./Storing_state_files/widgets.js" charset="utf-8"></script><meta name="next-head-count" content="17"><link rel="preload" href="./Storing_state_files/35554820b11cbb00a34e.css" as="style"><link rel="stylesheet" href="./Storing_state_files/35554820b11cbb00a34e.css" data-n-g=""><link rel="preload" href="./Storing_state_files/88b8f677cb762415fe8e.css" as="style"><link rel="stylesheet" href="./Storing_state_files/88b8f677cb762415fe8e.css" data-n-p=""><noscript data-n-css=""></noscript><script defer="" nomodule="" src="./Storing_state_files/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="./Storing_state_files/webpack-90a60b87fd0d5fc150f2.js" defer=""></script><script src="./Storing_state_files/framework-895f067827ebe11ffe45.js" defer=""></script><script src="./Storing_state_files/main-201487bbfff51b9c2e95.js" defer=""></script><script src="./Storing_state_files/_app-ac3e9f4a2daef15322cd.js" defer=""></script><script src="./Storing_state_files/247-1c9525b42331d9630f94.js" defer=""></script><script src="./Storing_state_files/522-f7346dcade1160f9e76b.js" defer=""></script><script src="./Storing_state_files/react-state-url-453d253560fd74369c01.js" defer=""></script><script src="./Storing_state_files/_buildManifest.js" defer=""></script><script src="./Storing_state_files/_ssgManifest.js" defer=""></script><script charset="utf-8" src="./Storing_state_files/tweet.2d13d9c81f3c2ba95ef78654d9a09632.js"></script><link as="script" rel="prefetch" href="./Storing_state_files/247-1c9525b42331d9630f94.js"><link as="script" rel="prefetch" href="./Storing_state_files/522-f7346dcade1160f9e76b.js"><link as="script" rel="prefetch" href="./Storing_state_files/index-8992336354f61198b0ff.js"></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><a href="https://pierrehedkvist.com/"><div style="display:inline-block;max-width:100%;overflow:hidden;position:relative;box-sizing:border-box;margin:0"><div style="box-sizing:border-box;display:block;max-width:100%"><img style="max-width:100%;display:block;margin:0;border:none;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA4IiBoZWlnaHQ9IjEwOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="></div><img alt="Pierre Hedkvist" srcset="/_next/image?url=%2Fimages%2Fme.png&amp;w=128&amp;q=75 1x, /_next/image?url=%2Fimages%2Fme.png&amp;w=256&amp;q=75 2x" src="./Storing_state_files/me.png" decoding="async" data-nimg="intrinsic" class="utils_borderCircle__13qdJ" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"><noscript><img alt="Pierre Hedkvist" srcSet="/_next/image?url=%2Fimages%2Fme.png&amp;w=128&amp;q=75 1x, /_next/image?url=%2Fimages%2Fme.png&amp;w=256&amp;q=75 2x" src="/_next/image?url=%2Fimages%2Fme.png&amp;w=256&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="utils_borderCircle__13qdJ" loading="lazy"/></noscript></div></a><h2 class="utils_headingLg__de7p0"><a class="utils_colorInherit__3Gudf" href="https://pierrehedkvist.com/">Pierre Hedkvist</a></h2></header><main><article class="blog-post"><h1 class="utils_headingXl__1XecN">Storing state in the URL with React</h1><div class="utils_lightText__12Ckm"><time datetime="2022-03-11">March 11, 2022</time></div><div></div><p><a href="https://en.wikipedia.org/wiki/Deep_linking" target="_blank">Deep linking</a> <!-- -->is a fundamental part of the web. It makes it possible to share links to pages with specific information. Take this link for instance:<!-- --> <a href="https://www.google.com/search?q=react" target="_blank">https://www.google.com/search?q=react</a>. It contains a query parameter, that contains the key q, and value react. Upon entering the page, a google search page will appear with results for the given keyword.</p><p>You can also think of a UI that can contain several filters. After you have spent time setting up your desired filter, you might accidentally close the window. Then re-opening the site, you have to go trough the hassle of setting up the filter all over again 😬. This happens because the site doesn't save the filter anywhere. If the site did put the all filter settings in the URL, this wouldn't be a problem.</p><p>Try changing the inputs below, and look at the URL.</p><div><label for="bool">Checkbox</label><input type="checkbox" name="bool"></div><div><label for="volume">Slider</label><input type="range" id="volume" name="volume" min="0" max="100" value="10"></div><p>Now refresh the page. 😃</p><p>A tweet by Kent C. Doods highlights this type of issue, and propose that you should treat the url as the source of state, and ditching the local state in return.</p><div class="twitter-tweet twitter-tweet-rendered" style="display: flex; max-width: 550px; width: 100%; margin-top: 10px; margin-bottom: 10px;"><iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" class="" style="position: static; visibility: visible; width: 550px; height: 321px; display: block; flex-grow: 1;" title="Twitter Tweet" src="./Storing_state_files/Tweet.html" data-tweet-id="1349173470567964673"></iframe></div><p>I have found several hooks that makes it easy to implement this. Alibaba has a collection of React hooks, one called <strong>useUrlState</strong> which you start using directly<!-- --> <a href="https://ahooks.js.org/hooks/use-url-state/" target="_blank">here</a>. I decided to use these as inspiration for a hook I made myself. It looks like this.</p><pre class="language-typescript" tabindex="0"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useStateParams</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  initialState<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  paramsName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token function-variable function">serialize</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token function-variable function">deserialize</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">useHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> search <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> existingValue <span class="token operator">=</span> search<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>paramsName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
    existingValue <span class="token operator">?</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>existingValue<span class="token punctuation">)</span> <span class="token operator">:</span> initialState
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Updates state when user navigates backwards or forwards in browser history</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>existingValue <span class="token operator">&amp;&amp;</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>existingValue<span class="token punctuation">)</span> <span class="token operator">!==</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">deserialize</span><span class="token punctuation">(</span>existingValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>existingValue<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> searchParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>paramsName<span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> pathname <span class="token operator">=</span> history<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pathname<span class="token punctuation">,</span> search<span class="token operator">:</span> searchParams<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> onChange<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>It has four parameters. The first is the initial state of the hook. The second parameter is the name of the query param that will be shown in the url. The third function is a serialization function, that will take the state and turn it into a url friendly string. The fourth de-serialization function, will take the string and transform it back to the state. In the fourth step, its a good practice to make sure that the value is of correct type, since you don't want the rest of you application to fail because of invalid query params. You can extend the above hook to have more complicated types of query parameters that fit your needs. The one above is designed using react-router. But it could be used with other routing libraries as well.</p><p>The slider and the checkbox can then be used in the following way.</p><pre class="language-typescript" tabindex="0"><code class="language-typescript">
<span class="token keyword">const</span> <span class="token punctuation">[</span>bool<span class="token punctuation">,</span> setBool<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useStateParams</span><span class="token punctuation">(</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string">'boolean'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>s <span class="token operator">?</span> <span class="token string">'true'</span> <span class="token operator">:</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s <span class="token operator">===</span> <span class="token string">'true'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>slider<span class="token punctuation">,</span> setSlider<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useStateParams</span><span class="token punctuation">(</span>
  <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token string">'slider'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">!==</span> Number<span class="token punctuation">.</span><span class="token number">NaN</span> <span class="token operator">?</span> <span class="token function">Number</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></article></main><div class="layout_backToHome__1vZsp"><a href="https://pierrehedkvist.com/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"react-state-url","title":"Storing state in the URL with React","date":"2022-03-11"}},"__N_SSG":true},"page":"/posts/react-state-url","query":{},"buildId":"FoRK6OWb9YzsT9PufLaJ4","isFallback":false,"gsp":true,"scriptLoader":[]}</script><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./Storing_state_files/widget_iframe.d37472b4a6622d0b1fff46ad904f6896.html" title="Twitter settings iframe" style="display: none;"></iframe><script src="./Storing_state_files/script.js" async="true" defer="true" data-api="/proxy/api/event" data-domain="pierrehedkvist.com" data-nscript="afterInteractive"></script><script id="next-plausible-init" data-nscript="afterInteractive">window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><next-route-announcer><p aria-live="assertive" id="__next-route-announcer__" role="alert" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; width: 1px; white-space: nowrap; overflow-wrap: normal;"></p></next-route-announcer><iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;" title="Twitter analytics iframe" src="./Storing_state_files/saved_resource.html"></iframe><script src="./Storing_state_files/index-8992336354f61198b0ff.js"></script></body></html>